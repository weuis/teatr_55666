<!-- frontend/booking.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Бронювання місця</title>
</head>
<body>
  <h1>Обрати спектакль та місце</h1>
  <select id="performance-select"></select>
  <div id="seats"></div>

  <script src="js/main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const token = localStorage.getItem('access');
      const perfRes = await fetch('http://127.0.0.1:8000/api/v1/theatre/performances/');
      const performances = await perfRes.json();
      const select = document.getElementById('performance-select');

      performances.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = `${p.play.title} (${p.date})`;
        select.appendChild(option);
      });

      select.addEventListener('change', loadSeats);

      async function loadSeats() {
        const id = select.value;
        const res = await fetch(`http://127.0.0.1:8000/api/v1/theatre/theater-halls/${id}/seats/`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const seats = await res.json();

        const container = document.getElementById('seats');
        container.innerHTML = '';
        seats.forEach(seat => {
          const btn = document.createElement('button');
          btn.textContent = `Місце ${seat.number}`;
          btn.disabled = seat.is_reserved;
          btn.onclick = () => reserve(seat.id);
          container.appendChild(btn);
        });
      }

      async function reserve(seatId) {
        const token = localStorage.getItem('access');
        const response = await fetch('http://127.0.0.1:8000/api/v1/theatre/reservations/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ seat: seatId, performance: select.value })
        });

        if (response.ok) {
          alert("Заброньовано!");
          loadSeats();
        } else {
          alert("Помилка при бронюванні");
        }
      }
    });
  </script>
</body>
</html>
<nav>
  <a href="index.html">Головна</a> |
  <a href="booking.html">Бронювання</a> |
  <a href="my-tickets.html">Мої квитки</a> |
  <a href="payment.html">Оплата</a>
</nav>
